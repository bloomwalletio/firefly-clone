# Fastfile

default_platform(:ios)

platform :ios do
  desc "Build IPA"
  lane :build do
    Dir.chdir("../ios/App") do
      gym(
        scheme: "App",
        export_method: "app-store",
        workspace: "../ios/App/App.xcworkspace",
      )
    end
  end
end

platform :android do
  desc "Build AAB"
  lane :build do
    Dir.chdir("../android") do
      gradle(
        task: 'bundle',
        flavor: ENV['STAGE'],
        build_type: 'Release',
        project_dir: 'android/',
        print_command: false,
        properties: {
          "android.injected.signing.store.file" => ENV["KEYSTORE"],
          "android.injected.signing.store.password" => ENV["KEYSTORE_PASSWORD"],
          "android.injected.signing.key.alias" => ENV["KEY_ALIAS"],
          "android.injected.signing.key.password" => ENV["KEY_PASSWORD"],
        },
      )
      upload_to_play_store(
        json_key_data: ENV["JSON_KEY_DATA"],
        track: 'internal', # for testing
      )
    end
  end
end
